<?php // Gestión de la base de datos MySQL. // Ejemplo de dirname: // dirname ("/etc/passwd.txt"); --> devuelve /etc // _FILE_ -> contiene la ruta fisica del fichero. require_once dirname(_FILE_).'/config.php'; require_once dirname(_FILE_).'/funciones.php';  class Basedatos{        /**     * Sirve para comprobar si la instancia esta creada.     * @var Basedatos Contiene la instancia de Basedatos.      */    private static $_instancia;        /**     *     * @var booleano|mysqli Contiene el objeto mysqli después de que se haya     * establecido la conexión.     */    private static $_mysqli = false;        private function __construct(){                                    }    //$_self hace referencia a la propia clase.        /**     * Crea la conexión al servidor o devuelve error parando la ejecución.     *      * @return Basedatos Devuelve la referencia al objeto Basedatos.     */    public static  function getInstancia(){                if(! self::$_instancia instanceof self)          {            // Creamos una nueva instancia de basedatos.           self::$_instancia = new self;           //self::$_instancia = new Basedatos(); tb es válida.                      // Creamos el objeto mysqli y lo asignamos a $_mysqli           self::$_mysqli =@new mysqli(Config::$dbServidor, Config::                   $dbUsuario, Config::$dbPassword, Config::$dbDatabase);              if(self::$_mysqli->connect_error){                  echo "Error conectando Base Datos". self::$_mysqli->                          connect_error;                  self::$mysqli=false;                  die();                                        }          }          // Si la instancia ya estaba creada, la devolvemos.          return self::$_instance;            }    /**     * Cierra una conexión activa con el servidor.     *      * @access public     * @return boolean Siempre devolverá true.     */    public function close(){        if(self::$_mysqli)          {            self::$_mysqli->close();            self::$_mysqli=false;          }          return true;     }            public function insertarUsuario($nick, $password, $nombre,            $apellidos,$dni,$email,$telefono){          // Preparamos la instrucción SQL.                $stmt= self::$_mysqli->prepare("insert into amadeus_usuarios(            nick,password,nombre,apellidos,dni,email,telefono) values(?,?,?,?,?,?,?)")                 or  die(self::$mysqli->error);                // Enlazamos los parámetros.                $stmt->bind_param('sssssss',$nick,encriptar($password,10),$nombre,$apellidos,$dni,$email,$telefono);                // Ejecutamos la instrución.         $stmt->execute() or die(self::$_mysqli->error);                return "OK";     }    }?>